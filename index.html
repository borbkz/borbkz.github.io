<!DOCTYPE html>
de

<head>
	<title>Borb's KZ</title>
	<link rel="stylesheet" type="text/css" href="styles/style.css">
	<link rel="stylesheet" type="text/css"
		href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js">
	</script>
	<script type="text/javascript" src="utils/utils.js"></script>

	<script>
		$(document).ready(function () {
			var header = [ "Map", "Time", "Teleports Count", "Points", "Date", "Server"];
			var mapRequestBaseURL = "https://kztimerglobal.com/api/v1.0/records/top?"

			URI = getURIVars();
			steamID = "";
			if (typeof URI["steamid"] !== 'undefined') {
				steamID = URI["steamid"];
				if (isValidSteamID(steamID)) {

					$('#steamIDText').val(steamID);

				}
			}

			function retrieveStats(requestURL) {

				$.getJSON(requestURL, function (data) {
					var maps = [];

					$("#playername").text("Player: " + data[0]["player_name"])
					$.each(data, function (i, field) {

						var statRow = [ field["map_name"],
							field["time"], field["teleports"], field["points"],
							field["updated_on"], field["server_name"],
						];
						maps.push(statRow);
						//createTable(maps, header);


					}); //.each

					var spreadsheetContainer = $("#spreadsheet")[0];
					var hot = new Handsontable(spreadsheetContainer, {
						data: maps,
						height: 1000,
						width: 1000,
						colHeaders: header,
						columnSorting: true,
						filters: true,
						dropdownMenu: ["filter_by_condition"]
					});
				}); //end json
			}

			$("#getGlobalMapsButton").click(function () {

				var steamID = $('#steamIDText').val();

				if (!isValidSteamID(steamID)) {
					alert("invalid Steam ID!");
					return;
				}


				window.history.pushState("object or string", "Title", "?steamid=");;

				retrieveStats(
					"https://kztimerglobal.com/api/v1.0/records/top?steam_id=" + steamID +
					"&tickrate=128&stage=0&has_teleports=true&limit=500&modes_list_string=kz_timer"
				);
			});


		});
	</script>


</head>

<body>
	<div class="nav-container">
		<ul>

			<li><a class="active" href="index.html">Global Maps</a></li>
			<li><a href="local.html">Local Maps</a></li>
			<li><a href="jumpstats.html">Jumpstats</a></li>

		</ul>
		<div class="center">

			<div id="titleDiv">
				<div id="innerTitleDiv">
					<h1>Your Times Across All Servers (under construction)</h1>
				</div>
			</div>

			<div class="innerSelection">


				<div class="innerSelection">
					<a href="https://steamid.io/lookup/">Look up your Steam ID</a><br>
				</div>
				Steam ID: <input type="text" id="steamIDText" name="steamID" Value="Enter your SteamID" />
				<input type="button" id="getGlobalMapsButton" value="Fetch Times" />
			</div>

			<div class="inputSelection">
				<div class="innerSelection">
					<input type="checkbox" name="pro-runs-check" checked="checked">TP Runs
					<input type="checkbox" name="tp-runs-check" checked="checked">Pro Runs<br>

					<div id="playername"></div>
				</di>

			</div>


			<div class="table-container" id="spreadsheet">


			</div>

		</div>
	</div>
</body>

</html>
