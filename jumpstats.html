<!DOCTYPE html>

<head>
	<title>Borb's KZ</title>

	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

	<link rel="stylesheet" type="text/css"
		href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="styles/styles.css?v=2">

	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js">
	</script>
	<script type="text/javascript" src="utils/util.js?v=2"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
	</script>


	<script>
		var requestSteamID = "steam_id=";
		var requestJumpType = "&jumptype=";
		var requestLimit = "&limit=" + jumpLimit;
		var requestMinimum = "&greater_than_distance=" + jumpMin;

		var requestBind = "&is_crouch_bind=";
		var jumpstatsPBURLBase = "https://kztimerglobal.com/api/v1.0/jumpstats?";
		var globalTable;
		var personalTable;
		var steamID = "";
		$(document).ready(function () {
			var header = ["Player", "Jump Type", "Distance", "Strafe Count", "Binded", "Date", "Server"];


			var localContainer = $("#localJumpstatsContainer")[0];
			var globalContainer = $("#globalJumpstatsContainer")[0];
			URI = getURIVars();
			if (typeof URI["steamid"] !== 'undefined' && typeof URI["jumptype"] !== 'undefined') {
				steamID = URI["steamid"];
				jumptype = URI["jumptype"];
				if (isValidSteamID(steamID) && isValidStat(jumptype)) {

					$('#steamIDText').val(steamID);
					if (isValidStat(URI["jumptype"]))
						jumptype = URI["jumptype"];


					$("#" + jumptype + "Radio").click();


					$("#expandLocal").click(); //autoexpand if url linked by steamid
					retrieveStats(getRequestURL(steamID, jumptype, "both"), localContainer);
				}

			} else {
				steamID = localStorage.getItem("jumpstatSteamID");
				jumptype = localStorage.getItem("jumpstatType");
				binded = localStorage.getItem("jumpstatBinded");

				if (isValidSteamID(steamID) && isValidStat(jumptype) && isValidBind(binded)) {
					$('#steamIDText').val(steamID);
					$("#expandLocal").click();
					retrieveStats(getRequestURL(steamID, jumptype, binded), localContainer);

				}
			}


			function retrieveStats(requestURL, container) {

				$.getJSON(requestURL, function (data) {

					if (data.length == 0) {
						alert("No Times Found for " + steamID);
						return true;
					}
					var jumpstats = [];
					var servers = {};
					var playerName = sanitizeName(data[0]["player_name"]);
					var isbinded = $('input[name=bind]:checked').val();
					var jumpstatType = jumpstatsKey[data[0]["jump_type"]];
					if (isbinded === "both")
						isbinded = "";
					$.each(data, function (i, field) {

						server = "N/A";
						serverID = field["server_id"];

						if (serverID in servers) {
							server = servers[serverID];
						} else {

							server = getServerName(serverID);
							servers[serverID] = server.substring(0, 25);

						}
						var statRow = [sanitizeName(field["player_name"]), jumpstatType,
							field["distance"], field[
								"strafe_count"],
							field["is_crouch_bind"] ? "Yes" : "No", field[
								"created_on"],
							server
						];
						jumpstats.push(statRow);

						createTable(jumpstats, header, container)


					});

				}); //end json
			}

			$("#localJumpstatsButton").click(function () {

				var steamID = $('#steamIDText').val().trim();

				if (!isValidSteamID(steamID)) {
					alert("invalid Steam ID!");
					return;
				}
				jumpstatType = $('input[name=jumpstat]:checked').val();
				isbinded = $('input[name=bind]:checked').val();


				window.history.pushState("object or string", "Title", "?steamid=" + steamID + "&jumptype=" +
					jumpstatType);;

				localStorage.setItem("jumpstatSteamID", steamID)
				localStorage.setItem("jumpstatType", jumpstatType)
				localStorage.setItem("jumpstatBinded", isbinded)

				retrieveStats(getRequestURL(steamID, jumpstatType, isbinded), localContainer);
			});
			$("#globalJumpstatsButton").click(function () {


				jumpstatType = $('input[name=globalJumpstat]:checked').val();
				isbinded = $('input[name=globalBind]:checked').val();


				retrieveStats(getRequestURL("", jumpstatType, isbinded), globalContainer);
			});

			function getRequestURL(steamID, jumpstatType, binded) {

				requestBindURI = requestBind;
				if (binded === "both")
					requestBindURI = "";
				else if (binded === "binded")
					requestBindURI = requestBind + "true";
				else
					requestBindURI = requestBind + "false";

				steamParam = ""; //empty steamid parameter will fetch top global stats instead
				if (isValidSteamID(steamID))
					steamParam = requestSteamID + steamID;

				var requestURL = jumpstatsPBURLBase +
					steamParam +
					requestJumpType + jumpstatType +
					requestBindURI +
					requestMinimum + requestLimit;

				return requestURL;

			}


		});
	</script>

</head>

<body>

	<div class="page-container">


		<ul>
			<li><a href="index.html">Global Times</a></li>
			<li><a href="local.html">Your Times</a></li>
			<li><a href="maps.html">Map Picker</a></li>
			<li><a class="active" href="jumpstats.html">Jumpstats</a></li>
		</ul>
		<div class="content-wrap">

			<div class="accordion" id="accordion-times">
				<div class="card">
					<div class="card-header" id="headingGlobal">
						<h5 class="mb-0">
							<button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne"
								aria-expanded="true" aria-controls="collapseOne" id="expandGlobal">
								<h4>Global Top 10 Jumpstats</h4>
							</button>
						</h5>
					</div>

					<div id="collapseOne" class="collapse" aria-labelledby="headingGlobal"
						data-parent="#accordion-times">
						<div class="card-body">
							<div class="content-wrap">


								<div class="inputSelection">

									<div class="innerSelection">
										<input type="radio" id="globalBindRadio" name="globalBind" value="binded">Binded
										<input type="radio" id="globalNobindRadio" name="globalBind" value="unbinded">No
										Bind
										<input type="radio" id="globalBothRadio" name="globalBind" value="both"
											checked>Both
									</div>

									<div class="innerSelection">
										<input type="radio" id="globalLongjumpRadio" name="globalJumpstat"
											value="longjump" checked>Longjump
										<input type="radio" id="globalBhopRadio" name="globalJumpstat"
											value="bhop">Bunnyhop
										<input type="radio" id="globalMultihopRadio" name="globalJumpstat"
											value="multihop">Multihop
										<input type="radio" id="globalWeirdjumpRadio" name="globalJumpstat"
											value="weirdjump">Weirdjump
										<input type="radio" id="globalDropbhopRadio" name="globalJumpstat"
											value="dropbhop">Dropbhop
										<input type="radio" id="globalLadderjumpRadio" name="globalJumpstat"
											value="ladderjump">Ladder
										<input type="radio" id="globalCountjumpRadio" name="globalJumpstat"
											value="countjump">Countjump
									</div>

									<div class="innerSelection">
										<input type="button" id="globalJumpstatsButton" value="Fetch Jumpstat" />
									</div>


									<div id="globalJumpstatsContainer">
										<table class="global-table" id="jumpstatTable"></table>
									</div>
								</div>


							</div>

						</div>
					</div>
				</div>
				<div class="card">
					<div class="card-header" id="headingLocal">
						<h5 class="mb-0">
							<button class="btn btn-link collapsed" type="button" data-toggle="collapse"
								data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo"
								id="expandLocal">
								<h4>Your Top 10 Jumpstats</h4>
							</button>
						</h5>
					</div>
					<div id="collapseTwo" class="collapse" aria-labelledby="headingLocal"
						data-parent="#accordion-times">
						<div class="card-body">

							<div class="content-wrap">


								<div class="inputSelection">

									<div class="innerSelection">
										<input type="radio" id="bindRadio" name="bind" value="binded">Binded
										<input type="radio" id="nobindRadio" name="bind" value="unbinded">No Bind
										<input type="radio" id="bothRadio" name="bind" value="both" checked>Both
									</div>

									<div class="innerSelection">
										<input type="radio" id="longjumpRadio" name="jumpstat" value="longjump"
											checked>Longjump
										<input type="radio" id="bhopRadio" name="jumpstat" value="bhop">Bunnyhop
										<input type="radio" id="multihopRadio" name="jumpstat" value="multihop">Multihop
										<input type="radio" id="weirdjumpRadio" name="jumpstat"
											value="weirdjump">Weirdjump
										<input type="radio" id="dropbhopRadio" name="jumpstat" value="dropbhop">Dropbhop
										<input type="radio" id="ladderjumpRadio" name="jumpstat"
											value="ladderjump">Ladder
										<input type="radio" id="countjumpRadio" name="jumpstat"
											value="countjump">Countjump
									</div>

									<div class="innerSelection">

										<a href="https://steamid.io/lookup/">Steam ID Lookup</a>
										<input type="text" id="steamIDText" name="steamID" Value="Enter your SteamID" />

										<input type="button" id="localJumpstatsButton" value="Fetch Jumpstat" />
									</div>


									<div id="localJumpstatsContainer">
										<table class="local-table" id="jumpstatTable"></table>
									</div>
								</div>


							</div>
						</div>
					</div>
				</div>
			</div>
		</div>




		<footer class="container">
			<hr>
			<div class="text-center center-block">
				<a href="https://github.com/borbkz"><i id="social-github"
						class="fa fa-github-square fa-3x social"></i></a>
				<a href="https://steamcommunity.com/id/borbkz"><i id="social-steam"
						class="fa fa-steam-square fa-3x social"></i></a>
				<a href="mailto:borbkz@gmail.com"><i id="social-em" class="fa fa-envelope-square fa-3x social"></i></a>
			</div>

		</footer>





	</div>
</body>

</html>
