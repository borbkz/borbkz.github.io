<!DOCTYPE html>

<head>
	<title>Borb's KZ</title>
	<link rel="stylesheet" type="text/css" href="styles/style.css">
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script type="text/javascript" src="utils/utils.js"></script>

	<script>
		$(document).ready(function () {
			var header = ["Player", "Jump Type", "Distance", "Strafe Count", "Binded", "MSL", "Date", "Server"];

			var stats = ["longjump", "bhop", "multihop", "weirdjump", "ladderjump", "dropbhop"];

			URI = getURIVars();
			steamID = "";
			if (typeof URI["steamid"] !== 'undefined' && typeof URI["jumptype"] !== 'undefined') {
				steamID = URI["steamid"];
				jumptype = "longjump";
				if (isValidSteamID(steamID)) {

					$('#steamIDText').val(steamID);
					if (isValidStat(URI["jumptype"]))
						jumptype = URI["jumptype"];


					$("#" + jumptype + "Radio").click();

					retrieveStats(getRequestURL(steamID, jumptype, "both"), jumptype);
				}

			}

			function isValidStat(stat) {
				return stats.includes(stat);
			}


			function retrieveStats(requestURL, jumpstatType) {

				$.getJSON(requestURL, function (data) {
					var jumpstats = [];
					var servers = {};
					$.each(data, function (i, field) {

						server = "N/A";
						serverID = field["server_id"];

						if (serverID in servers) {
							server = servers[serverID];
						} else {

							server = getServerName(serverID);
							servers[serverID] = server.substring(0, 25);

						}
						var statRow = [field["player_name"], jumpstatType,
							field["distance"], field[
								"strafe_count"],
							field["is_crouch_bind"] ? "Yes" : "No", field["msl_count"], field[
								"created_on"],
							server
						];
						jumpstats.push(statRow);
						createTable(jumpstats, header);


					});

				}); //end json
			}

			$("#jumpstatButton").click(function () {

				var steamID = $('#steamIDText').val().trim();

				if (!isValidSteamID(steamID)) {
					alert("invalid Steam ID!");
					return;
				}
				jumpstatType = $('input[name=jumpstat]:checked').val();
				isbinded = $('input[name=bind]:checked').val();


				window.history.pushState("object or string", "Title", "?steamid=" + steamID + "&jumptype=" +
					jumpstatType);;

				retrieveStats(getRequestURL(steamID, jumpstatType, isbinded), jumpstatType);
			});

			function getRequestURL(steamID, jumpstatType, binded) {
				requestBindURI = requestBind;
				if (binded === "both")
					requestBindURI = "";
				else if (binded === "bind")
					requestBindURI = requestBind + "true";
				else
					requestBindURI = requestBind + "false";


				var requestURL = requestURLBase +
					requestSteamID + steamID +
					requestJumpType + jumpstatType +
					requestBindURI +
					requestMinimum + requestLimit;
				return requestURL;

			}


		});
	</script>


</head>

<body>
	<div class="nav-container">
		<ul>

			<li><a href="index.html">Global Maps</a></li>
			<li><a href="index.html">Local Maps</a></li>
			<li><a class="active" href="jumpstats.html">Jumpstats</a></li>

		</ul>
		<div class="center">



			<div class="textDiv">

				<div id="titleDiv">
					<div id="innerTitleDiv">
						<h1> Your Top 10 Jumpstat Personal Bests</h1>
					</div>
				</div>

				<div class="inputSelection">

					<div class="innerSelection">
						<input type="radio" id="bindRadio" name="bind" value="bind" checked>Binded
						<input type="radio" id="nobindRadio" name="bind" value="nobind">No Bind
						<input type="radio" id="bothRadio" name="bind" value="both">Both
					</div>

					<div class="innerSelection">
						<input type="radio" id="longjumpRadio" name="jumpstat" value="longjump" checked>Longjump
						<input type="radio" id="bhopRadio" name="jumpstat" value="bhop">Bunnyhop
						<input type="radio" id=multihopRadio" name="jumpstat" value="multihop">Multihop
						<input type="radio" id="weirdjumpRadio" name="jumpstat" value="weirdjump">Weirdjump
						<input type="radio" id=dropbhopRadio" name="jumpstat" value="dropbhop">Dropbhop
						<input type="radio" id="ladderjumpRadio" name="jumpstat" value="ladderjump">Ladderjump
					</div>

					<div class="innerSelection">


						<div class="innerSelection">
							<a href="https://steamid.io/lookup/">Look up your Steam ID</a><br>
						</div>
						Steam ID: <input type="text" id="steamIDText" name="steamID" Value="Enter your SteamID" />
						<input type="button" id="jumpstatButton" value="Fetch Jumpstat" />
					</div>

					<div class ="table-container">

					<table class="centerTable" id="jumpstatTable">

					</table>

					</div>

				</div>


			</div>

		</div>
	</div>
</body>

</html>
